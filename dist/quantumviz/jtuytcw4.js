/*! Built with http://stenciljs.com */
const{h:t}=window.quantumviz;import{a as e,b as i}from"./chunk-cbb0389a.js";import{a as s}from"./chunk-0b5c2300.js";import{a}from"./chunk-f78e876a.js";import"./chunk-ee323282.js";class r{constructor(){this.alone=!0,this.unit="",this.type="line",this.chartTitle="",this.responsive=!1,this.showLegend=!1,this.data="[]",this.hiddenData="[]",this.options="{}",this.width="",this.height="",this.config="{}",this.xView="{}",this.yView="{}",this._mapIndex={},this._xSlider={element:null,min:0,max:0},this._ySlider={element:null,min:0,max:0},this._config={rail:{class:""},cursor:{class:""}},this._type="timestamp"}toBase64Image(){return this._chart.toBase64Image()}redraw(t,e){e!==t&&this.drawChart()}changeScale(t,e){if(e!==t){const e=JSON.parse(t);console.log("changeScale",this._data),"timestamp"===e.time.timeMode?(delete this._chart.options.scales.xAxes[0].type,this._type="timestamp"):(this._type="time",this._chart.options.scales.xAxes[0].type="time",this._chart.options.scales.xAxes[0].ticks.stepSize=e.time.stepSize,this._chart.options.scales.xAxes[0].ticks.unit=e.time.unit),this._chart.update()}}hideData(t,e){if(e!==t){const e=s.cleanArray(JSON.parse(t));if(this._data=JSON.parse(this.data),!this._data)return;Object.keys(this._mapIndex).forEach(t=>{this._chart.getDatasetMeta(this._mapIndex[t]).hidden=!!e.find(e=>e===t),console.log(this._chart.getDatasetMeta(this._mapIndex[t]).dataset._children)}),this._chart.update()}}changeXView(){let t=JSON.parse(this.xView);"timestamp"===this._type?(this._chart.options.scales.xAxes[0].ticks.min=t.min,this._chart.options.scales.xAxes[0].ticks.max=t.max):(this._chart.options.scales.xAxes[0].ticks.min=i(t.min,"x"),this._chart.options.scales.xAxes[0].ticks.max=i(t.max,"x")),this._chart.update()}changeYView(){let t=JSON.parse(this.yView);this._chart.options.scales.yAxes[0].ticks.min=t.min,this._chart.options.scales.yAxes[0].ticks.max=t.max,this._chart.update()}buildGraph(){let t=this.el.shadowRoot.querySelector("#myChart"),s=this.gtsToData(this._data);const a=s.ticks.slice().sort(function(t,e){return t-e});console.log("buildGraph",s,this.timeMin?this.timeMin:a[0]);const r=this,h={animation:!1,legend:{display:!1},tooltips:{mode:"x",position:"nearest",custom:function(t){t.opacity>0?r.pointHover.emit({x:t.dataPoints[0].x+15,y:this._eventPosition.y}):r.pointHover.emit({x:-100,y:this._eventPosition.y})}},scales:{xAxes:[{ticks:{},type:"time"}],yAxes:[{afterFit:function(t){t.width=100},scaleLabel:{display:!0,labelString:this.unit}}]},responsive:this.responsive};"timestamp"===this._type?(delete h.scales.xAxes[0].type,h.scales.xAxes[0].ticks={min:this.timeMin?this.timeMin:a[0],max:this.timeMax?this.timeMax:a[s.ticks.length-1],beginAtZero:!1}):h.scales.xAxes[0].ticks={min:i(this.timeMin?this.timeMin:a[0],"x"),max:i(this.timeMax?this.timeMax:a[s.ticks.length-1],"x"),unit:"day"},"spline"===this.type&&(h.elements={line:{lineTension:0}}),"area"===this.type&&(h.elements={line:{fill:"start"}}),this._chart=new e(t,{type:"bar"===this.type?this.type:"line",data:{labels:s.ticks,datasets:s.datasets},options:h});let o=[],n=[];if(s.datasets.forEach(t=>{let e=Math.max(...t.data);e&&e!=1/0&&o.push(e)}),s.datasets.forEach(t=>{let e=Math.min(...t.data);(0==e||e&&e!=1/0)&&n.push(e)}),this._ySlider.min=Math.min(...n),this._ySlider.max=1.05*Math.max(...o),this._chart.options.scales.yAxes[0].ticks.min=this._ySlider.min,this._chart.options.scales.yAxes[0].ticks.max=this._ySlider.max,this._chart.update(),this._xSlider.min=a[0],this._xSlider.max=a[a.length-1],this.alone)console.log("Not alone");else{console.log("Alone",a[0],a[a.length-1]);let t={xMin:a[0],xMax:a[a.length-1],yMin:Math.min(...n),yMax:1.05*Math.max(...o)};this.chartInfos.emit(t)}}drawChart(){this._data=JSON.parse(this.data),this._data&&this.buildGraph()}gtsToData(t){let e=[],i=[],a=0;if(t)return t.forEach(t=>{if(t.gts){t.gts=s.flatDeep(t.gts);let r=0;t.gts.forEach(h=>{let o=[];if(h.v){h.v.forEach(t=>{i.push(t[0]/1e3),o.push(t[t.length-1])});let n=s.getColor(a);t.params&&t.params[r]&&t.params[r].color&&(n=t.params[r].color);let l=s.serializeGtsMetadata(h);this._mapIndex[l]=a,t.params&&t.params[r]&&t.params[r].key&&(l=t.params[r].key);let c={label:l,data:o,pointRadius:0,fill:!1,steppedLine:this.isStepped(),borderColor:n,borderWidth:1,backgroundColor:s.transparentize(n,.5)};if(t.params&&t.params[r]&&t.params[r].interpolate)switch(t.params[r].interpolate){case"line":c.lineTension=0;break;case"spline":break;case"area":c.fill=!0}else c.lineTension=0;e.push(c),a++,r++}})}}),{datasets:e,ticks:s.unique(i)}}isStepped(){return!!this.type.startsWith("step")&&this.type.replace("step-","")}componentWillLoad(){this._config=s.mergeDeep(this._config,JSON.parse(this.config))}componentDidLoad(){this.drawChart()}render(){return t("div",null,t("h1",null,this.chartTitle),t("div",{class:"chart-container"},this.responsive?t("canvas",{id:"myChart"}):t("canvas",{id:"myChart",width:this.width,height:this.height})))}static get is(){return"quantum-chart"}static get encapsulation(){return"shadow"}static get properties(){return{alone:{type:Boolean,attr:"alone"},chartTitle:{type:String,attr:"chart-title"},config:{type:String,attr:"config"},data:{type:String,attr:"data",watchCallbacks:["redraw"]},el:{elementRef:!0},height:{type:String,attr:"height"},hiddenData:{type:String,attr:"hidden-data",watchCallbacks:["hideData"]},options:{type:String,attr:"options",watchCallbacks:["changeScale"]},responsive:{type:Boolean,attr:"responsive"},showLegend:{type:Boolean,attr:"show-legend"},timeMax:{type:Number,attr:"time-max"},timeMin:{type:Number,attr:"time-min"},toBase64Image:{method:!0},type:{type:String,attr:"type"},unit:{type:String,attr:"unit"},width:{type:String,attr:"width"},xView:{type:String,attr:"x-view",watchCallbacks:["changeXView"]},yView:{type:String,attr:"y-view",watchCallbacks:["changeYView"]}}}static get events(){return[{name:"pointHover",method:"pointHover",bubbles:!0,cancelable:!0,composed:!0},{name:"boundsDidChange",method:"boundsDidChange",bubbles:!0,cancelable:!0,composed:!0},{name:"chartInfos",method:"chartInfos",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"quantum-chart .chart-container{width:var(--quantum-chart-width,100%);height:var(--quantum-chart-height,100%);position:relative}"}}class h{constructor(){this.cursorSize="{}",this.config="{}",this._cursorMinWidth=30,this.lastPos=0}changeCursorSize(t,e){if(e!==t){let e=JSON.parse(t);e.cursorOffset+e.cursorSize<=100&&(this._cursor.style.left=(100*e.cursorOffset).toString()+"%",window.requestAnimationFrame(()=>{e.cursorSize*this._rail.getBoundingClientRect().width<this._cursorMinWidth?this._cursor.style.width=this._cursorMinWidth.toString()+"px":this._cursor.style.width=(100*e.cursorSize).toString()+"%"}))}}initSize(t,e){e!==t&&(this._rail.style.width=(.94*t).toString()+"px",this._img.style.width=(t+18).toString()+"px")}componentWillLoad(){}componentDidLoad(){this._rail=this.el.shadowRoot.querySelector("#rail"),this._cursor=this.el.shadowRoot.querySelector("#cursor"),this._img=this.el.shadowRoot.querySelector("#img");let t=new a(this._cursor,{axis:"x",containment:this._rail});t.on("dragStart",(t,e)=>{this.dimsX(t)}),t.on("dragMove",(t,e,i)=>{if(t.pageX-this._mouseCursorLeftOffset>=this._railMin+1&&t.pageX+this._mouseCursorRightOffset<=this._railMax-1){let e=t.pageX-this._rail.offsetLeft-this._mouseCursorLeftOffset,i=(e=Math.max(0,e))/(this._railMax-this._railMin-this._cursorWidth)*(this.maxValue-this.minValue)+this.minValue;window.setTimeout(()=>this.xSliderValueChanged.emit({sliderValue:i}))}})}dimsX(t){let e=this._rail.getBoundingClientRect(),i=this._cursor.getBoundingClientRect();this._railMin=this._rail.offsetLeft,this._railMax=e.width+this._rail.offsetLeft,this._cursorWidth=i.width,this._mouseCursorLeftOffset=t.pageX-this._cursor.offsetLeft-this._rail.offsetLeft,this._mouseCursorRightOffset=i.width-this._mouseCursorLeftOffset}xWheel(t){t.preventDefault();let e=this._rail.getBoundingClientRect(),i=(t.pageX-this._rail.offsetLeft)/e.width;this.xZoom.emit({zoomValue:{coef:i,zoomType:-1*t.deltaY}})}positionClick(t){if(t.preventDefault(),t.pageX<this._railMin+this._cursor.offsetLeft||t.pageX>this._railMin+this._cursor.offsetLeft+this._cursorWidth){this.dimsX(t);let e,i=this._cursorWidth/2;t.pageX-i<this._rail.offsetLeft?(e=0,this._cursor.style.left="1px"):t.pageX+i>this._railMax?(e=this._railMax-this._railMin-this._cursorWidth,this._cursor.style.left=e.toString()+"px"):(e=t.pageX-this._railMin-i,this._cursor.style.left=e.toString()+"px");let s=e/(this._railMax-this._railMin-this._cursorWidth)*(this.maxValue-this.minValue)+this.minValue;this.xSliderValueChanged.emit({sliderValue:s})}}render(){return t("div",{id:"rail",onWheel:t=>this.xWheel(t),onMouseUp:t=>this.positionClick(t)},t("div",{id:"cursor"}),t("img",{id:"img",src:this.img}))}static get is(){return"quantum-horizontal-zoom-map"}static get encapsulation(){return"shadow"}static get properties(){return{config:{type:String,attr:"config"},cursorSize:{type:String,attr:"cursor-size",watchCallbacks:["changeCursorSize"]},el:{elementRef:!0},img:{type:String,attr:"img"},maxValue:{type:Number,attr:"max-value"},minValue:{type:Number,attr:"min-value"},width:{type:Number,attr:"width",watchCallbacks:["initSize"]}}}static get events(){return[{name:"xSliderValueChanged",method:"xSliderValueChanged",bubbles:!0,cancelable:!0,composed:!0},{name:"xZoom",method:"xZoom",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return":host #rail{position:relative;border:1px solid #000;float:right;margin:0 0 0 100px;position:absolute;height:100px;width:100%;overflow:hidden}:host #img{position:absolute;height:100px;top:0;right:-1.5%}:host #cursor:hover{opacity:.6}:host #cursor{z-index:1;opacity:.3;background-color:grey;position:relative;cursor:move;width:100%;height:100%;border-left:3px solid red;border-right:3px solid red;-webkit-transition:left .01s;transition:left .01s}"}}export{r as QuantumChart,h as QuantumHorizontalZoomMap};