/*
 *  Copyright 2020  SenX S.A.S.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 */
import { DataModel } from '../model/dataModel';
import { Logger } from './logger';
import moment from 'moment-timezone';
// @dynamic
export class GTSLib {
    static cleanArray(actual) {
        return actual.filter((i) => !!i);
    }
    static unique(arr) {
        const u = {};
        const a = [];
        for (let i = 0, l = arr.length; i < l; ++i) {
            if (!u.hasOwnProperty(arr[i])) {
                a.push(arr[i]);
                u[arr[i]] = 1;
            }
        }
        return a;
    }
    static isArray(value) {
        return value && typeof value === 'object' && value instanceof Array && typeof value.length === 'number'
            && typeof value.splice === 'function' && !(value.propertyIsEnumerable('length'));
    }
    static formatElapsedTime(elapsed) {
        if (elapsed < 1000) {
            return elapsed.toFixed(3) + ' ns';
        }
        if (elapsed < 1000000) {
            return (elapsed / 1000).toFixed(3) + ' μs';
        }
        if (elapsed < 1000000000) {
            return (elapsed / 1000000).toFixed(3) + ' ms';
        }
        if (elapsed < 1000000000000) {
            return (elapsed / 1000000000).toFixed(3) + ' s ';
        }
        // Max exec time for nice output: 999.999 minutes (should be OK, timeout should happen before that).
        return (elapsed / 60000000000).toFixed(3) + ' m ';
    }
    static isValidResponse(data) {
        let response;
        try {
            response = JSON.parse(data);
        }
        catch (e) {
            this.LOG.error(['isValidResponse'], 'Response non JSON compliant', data);
            return false;
        }
        if (!GTSLib.isArray(response)) {
            this.LOG.error(['isValidResponse'], 'Response isn\'t an Array', response);
            return false;
        }
        return true;
    }
    static isEmbeddedImage(item) {
        return !(typeof item !== 'string' || !/^data:image/.test(item));
    }
    static isEmbeddedImageObject(item) {
        return !((item === null) || (item.image === null) ||
            (item.caption === null) || !GTSLib.isEmbeddedImage(item.image));
    }
    static isPositionArray(item) {
        if (!item || !item.positions) {
            return false;
        }
        if (GTSLib.isPositionsArrayWithValues(item) || GTSLib.isPositionsArrayWithTwoValues(item)) {
            return true;
        }
        (item.positions || []).forEach(p => {
            if (p.length < 2 || p.length > 3) {
                return false;
            }
            for (const j in p) {
                if (typeof p[j] !== 'number') {
                    return false;
                }
            }
        });
        return true;
    }
    static isPositionsArrayWithValues(item) {
        if ((item === null) || (item.positions === null)) {
            return false;
        }
        (item.positions || []).forEach(p => {
            if (p.length !== 3) {
                return false;
            }
            for (const j in p) {
                if (typeof p[j] !== 'number') {
                    return false;
                }
            }
        });
        return true;
    }
    static isPositionsArrayWithTwoValues(item) {
        if ((item === null) || (item.positions === null)) {
            return false;
        }
        (item.positions || []).forEach(p => {
            if (p.length !== 4) {
                return false;
            }
            for (const j in p) {
                if (typeof p[j] !== 'number') {
                    return false;
                }
            }
        });
        return true;
    }
    static gtsFromJSON(json, id) {
        return { gts: { c: json.c, l: json.l, a: json.a, v: json.v, id } };
    }
    static gtsFromJSONList(jsonList, prefixId) {
        const gtsList = [];
        let id;
        (jsonList || []).forEach((item, i) => {
            let gts = item;
            if (item.gts) {
                gts = item.gts;
            }
            if ((prefixId !== undefined) && (prefixId !== '')) {
                id = prefixId + '-' + i;
            }
            else {
                id = i;
            }
            if (GTSLib.isArray(gts)) {
                gtsList.push(GTSLib.gtsFromJSONList(gts, id));
            }
            if (GTSLib.isGts(gts)) {
                gtsList.push(GTSLib.gtsFromJSON(gts, id));
            }
            if (GTSLib.isEmbeddedImage(gts)) {
                gtsList.push({ image: gts, caption: 'Image', id });
            }
            if (GTSLib.isEmbeddedImageObject(gts)) {
                gtsList.push({ image: gts.image, caption: gts.caption, id });
            }
        });
        return {
            content: gtsList || [],
        };
    }
    static flatDeep(arr1) {
        if (!GTSLib.isArray(arr1)) {
            arr1 = [arr1];
        }
        return arr1.reduce((acc, val) => Array.isArray(val) ? acc.concat(GTSLib.flatDeep(val)) : acc.concat(val), []);
    }
    static flattenGtsIdArray(a, r) {
        const res = [];
        if (GTSLib.isGts(a)) {
            a = [a];
        }
        (a || []).forEach(d => {
            if (GTSLib.isArray(d)) {
                const walk = GTSLib.flattenGtsIdArray(d, r);
                res.push(walk.res);
                r = walk.r;
            }
            else if (d && d.v) {
                d.id = r;
                res.push(d);
                r++;
            }
        });
        return { res, r };
    }
    static sanitizeNames(input) {
        return (input || '').replace(/{/g, '&#123;')
            .replace(/}/g, '&#125;')
            .replace(/,/g, '&#44;')
            .replace(/>/g, '&#62;')
            .replace(/</g, '&#60;')
            .replace(/"/g, '&#34;')
            .replace(/'/g, '&#39;');
    }
    static serializeGtsMetadata(gts) {
        const serializedLabels = [];
        const serializedAttributes = [];
        if (gts.l) {
            Object.keys(gts.l).forEach((key) => {
                serializedLabels.push(this.sanitizeNames(key + '=' + gts.l[key]));
            });
        }
        if (gts.a) {
            Object.keys(gts.a).forEach((key) => {
                serializedAttributes.push(this.sanitizeNames(key + '=' + gts.a[key]));
            });
        }
        // tslint:disable-next-line:max-line-length
        return `${this.sanitizeNames(gts.c)}{${serializedLabels.join(',')}${serializedAttributes.length > 0 ? ',' : ''}${serializedAttributes.join(',')}}`;
    }
    static isGts(item) {
        return !!item && (item.c === '' || !!item.c) && !!item.v && GTSLib.isArray(item.v);
    }
    static isGtsToPlot(gts) {
        if (!GTSLib.isGts(gts) || gts.v.length === 0) {
            return false;
        }
        // We look at the first non-null value, if it's a String or Boolean it's an annotation GTS,
        // if it's a number it's a GTS to plot
        return (gts.v || []).some(v => {
            // noinspection JSPotentiallyInvalidConstructorUsage
            return typeof v[v.length - 1] === 'number' || !!v[v.length - 1].constructor.prototype.toFixed;
        });
    }
    static isGtsToPlotOnMap(gts) {
        if (!GTSLib.isGts(gts) || gts.v.length === 0) {
            return false;
        }
        // We look at the first non-null value, if it's a String or Boolean it's an annotation GTS,
        // if it's a number it's a GTS to plot
        return (gts.v || []).some(v => {
            return v.length >= 3;
        });
    }
    static isSingletonGTS(gts) {
        if (!GTSLib.isGts(gts) || gts.v.length === 0) {
            return false;
        }
        return (gts.v || []).length === 1;
    }
    static isGtsToAnnotate(gts) {
        if (!GTSLib.isGts(gts) || gts.v.length === 0) {
            return false;
        }
        // We look at the first non-null value, if it's a String or Boolean it's an annotation GTS,
        // if it's a number it's a GTS to plot
        return (gts.v || []).some(v => {
            if (v[v.length - 1] !== null) {
                // noinspection JSPotentiallyInvalidConstructorUsage
                return typeof (v[v.length - 1]) !== 'number' &&
                    (!!v[v.length - 1].constructor && v[v.length - 1].constructor.name !== 'Big') &&
                    v[v.length - 1].constructor.prototype.toFixed === undefined;
            }
        });
    }
    static gtsSort(gts) {
        if (gts.isSorted) {
            return;
        }
        gts.v = gts.v.sort((a, b) => a[0] - b[0]);
        gts.isSorted = true;
    }
    static getData(data) {
        if (typeof data === 'string') {
            return GTSLib.getData(JSON.parse(data));
        }
        else if (data && data.hasOwnProperty('data')) {
            if (!GTSLib.isArray(data.data)) {
                data.data = [data.data];
            }
            return data;
        }
        else if (GTSLib.isArray(data) && data.length > 0 && data[0].data) {
            return data[0];
        }
        else if (GTSLib.isArray(data)) {
            return { data: data };
        }
        return new DataModel();
    }
    static getDivider(timeUnit) {
        let timestampDivider = 1000; // default for µs timeunit
        if (timeUnit === 'ms') {
            timestampDivider = 1;
        }
        if (timeUnit === 'ns') {
            timestampDivider = 1000000;
        }
        return timestampDivider;
    }
    static toISOString(timestamp, divider, timeZone) {
        if (timeZone !== 'UTC') {
            return moment.tz(timestamp / divider, timeZone).format();
        }
        else {
            return moment(timestamp / divider).toISOString();
        }
    }
}
GTSLib.LOG = new Logger(GTSLib);
GTSLib.formatLabel = (data) => {
    const serializedGTS = data.split('{');
    let display = `<span class="gtsInfo"><span class='gts-classname'>${serializedGTS[0]}</span>`;
    if (serializedGTS.length > 1) {
        display += `<span class='gts-separator'>{</span>`;
        const labels = serializedGTS[1].substr(0, serializedGTS[1].length - 1).split(',');
        if (labels.length > 0) {
            labels.forEach((l, i) => {
                const label = l.split('=');
                if (l.length > 1) {
                    display += `<span><span class='gts-labelname'>${label[0]}</span>
<span class='gts-separator'>=</span><span class='gts-labelvalue'>${label[1]}</span>`;
                    if (i !== labels.length - 1) {
                        display += `<span>, </span>`;
                    }
                }
            });
        }
        display += `<span class='gts-separator'>}</span>`;
    }
    if (serializedGTS.length > 2) {
        display += `<span class='gts-separator'>{</span>`;
        const labels = serializedGTS[2].substr(0, serializedGTS[2].length - 1).split(',');
        if (labels.length > 0) {
            labels.forEach((l, i) => {
                const label = l.split('=');
                if (l.length > 1) {
                    display += `<span><span class='gts-attrname'>${label[0]}</span>
<span class='gts-separator'>=</span><span class='gts-attrvalue'>${label[1]}</span>`;
                    if (i !== labels.length - 1) {
                        display += `<span>, </span>`;
                    }
                }
            });
        }
        display += `<span class='gts-separator'>}</span>`;
    }
    display += '</span>';
    return display;
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3RzLmxpYi5qcyIsInNvdXJjZVJvb3QiOiIvaG9tZS94YXZpZXIvd29ya3NwYWNlL3dhcnAtdmlldy9wcm9qZWN0cy93YXJwdmlldy1uZy8iLCJzb3VyY2VzIjpbInNyYy9saWIvdXRpbHMvZ3RzLmxpYi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7Ozs7O0dBZUc7QUFFSCxPQUFPLEVBQUMsU0FBUyxFQUFDLE1BQU0sb0JBQW9CLENBQUM7QUFFN0MsT0FBTyxFQUFDLE1BQU0sRUFBQyxNQUFNLFVBQVUsQ0FBQztBQUNoQyxPQUFPLE1BQU0sTUFBTSxpQkFBaUIsQ0FBQztBQUVyQyxXQUFXO0FBQ1gsTUFBTSxPQUFPLE1BQU07SUFHakIsTUFBTSxDQUFDLFVBQVUsQ0FBQyxNQUFhO1FBQzdCLE9BQU8sTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ25DLENBQUM7SUFFRCxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUc7UUFDZixNQUFNLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDYixNQUFNLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDYixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFO1lBQzFDLElBQUksQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO2dCQUM3QixDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNmLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7YUFDZjtTQUNGO1FBQ0QsT0FBTyxDQUFDLENBQUM7SUFDWCxDQUFDO0lBRUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLO1FB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LEdBQUcsQ0FBQyxDQUFDO1FBQ2xGLElBQUksTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDckIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRTtnQkFDdEIsTUFBTSxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDM0IsSUFBSSxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtvQkFDaEIsT0FBTyxJQUFJLG9DQUFvQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2tFQUNELEtBQUssQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO29CQUN4RSxJQUFJLENBQUMsS0FBSyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTt3QkFDM0IsT0FBTyxJQUFJLGlCQUFpQixDQUFDO3FCQUM5QjtpQkFDRjtZQUNILENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFDRCxPQUFPLElBQUksc0NBQXNDLENBQUM7S0FDbkQ7SUFDRCxPQUFPLElBQUksU0FBUyxDQUFDO0lBQ3JCLE9BQU8sT0FBTyxDQUFDO0FBQ2pCLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiAgQ29weXJpZ2h0IDIwMjAgIFNlblggUy5BLlMuXG4gKlxuICogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiAgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqICBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiAgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqICBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqXG4gKi9cblxuaW1wb3J0IHtEYXRhTW9kZWx9IGZyb20gJy4uL21vZGVsL2RhdGFNb2RlbCc7XG5pbXBvcnQge0dUU30gZnJvbSAnLi4vbW9kZWwvR1RTJztcbmltcG9ydCB7TG9nZ2VyfSBmcm9tICcuL2xvZ2dlcic7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudC10aW1lem9uZSc7XG5cbi8vIEBkeW5hbWljXG5leHBvcnQgY2xhc3MgR1RTTGliIHtcbiAgcHJpdmF0ZSBzdGF0aWMgTE9HOiBMb2dnZXIgPSBuZXcgTG9nZ2VyKEdUU0xpYik7XG5cbiAgc3RhdGljIGNsZWFuQXJyYXkoYWN0dWFsOiBhbnlbXSkge1xuICAgIHJldHVybiBhY3R1YWwuZmlsdGVyKChpKSA9PiAhIWkpO1xuICB9XG5cbiAgc3RhdGljIHVuaXF1ZShhcnIpIHtcbiAgICBjb25zdCB1ID0ge307XG4gICAgY29uc3QgYSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwLCBsID0gYXJyLmxlbmd0aDsgaSA8IGw7ICsraSkge1xuICAgICAgaWYgKCF1Lmhhc093blByb3BlcnR5KGFycltpXSkpIHtcbiAgICAgICAgYS5wdXNoKGFycltpXSk7XG4gICAgICAgIHVbYXJyW2ldXSA9IDE7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhO1xuICB9XG5cbiAgc3RhdGljIGlzQXJyYXkodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSBpbnN0YW5jZW9mIEFycmF5ICYmIHR5cGVvZiB2YWx1ZS5sZW5ndGggPT09ICdudW1iZXInXG4gICAgICAmJiB0eXBlb2YgdmFsdWUuc3BsaWNlID09PSAnZnVuY3Rpb24nICYmICEodmFsdWUucHJvcGVydHlJc0VudW1lcmFibGUoJ2xlbmd0aCcpKTtcbiAgfVxuXG4gIHN0YXRpYyBmb3JtYXRFbGFwc2VkVGltZShlbGFwc2VkOiBudW1iZXIpIHtcbiAgICBpZiAoZWxhcHNlZCA8IDEwMDApIHtcbiAgICAgIHJldHVybiBlbGFwc2VkLnRvRml4ZWQoMykgKyAnIG5zJztcbiAgICB9XG4gICAgaWYgKGVsYXBzZWQgPCAxMDAwMDAwKSB7XG4gICAgICByZXR1cm4gKGVsYXBzZWQgLyAxMDAwKS50b0ZpeGVkKDMpICsgJyDOvHMnO1xuICAgIH1cbiAgICBpZiAoZWxhcHNlZCA8IDEwMDAwMDAwMDApIHtcbiAgICAgIHJldHVybiAoZWxhcHNlZCAvIDEwMDAwMDApLnRvRml4ZWQoMykgKyAnIG1zJztcbiAgICB9XG4gICAgaWYgKGVsYXBzZWQgPCAxMDAwMDAwMDAwMDAwKSB7XG4gICAgICByZXR1cm4gKGVsYXBzZWQgLyAxMDAwMDAwMDAwKS50b0ZpeGVkKDMpICsgJyBzICc7XG4gICAgfVxuICAgIC8vIE1heCBleGVjIHRpbWUgZm9yIG5pY2Ugb3V0cHV0OiA5OTkuOTk5IG1pbnV0ZXMgKHNob3VsZCBiZSBPSywgdGltZW91dCBzaG91bGQgaGFwcGVuIGJlZm9yZSB0aGF0KS5cbiAgICByZXR1cm4gKGVsYXBzZWQgLyA2MDAwMDAwMDAwMCkudG9GaXhlZCgzKSArICcgbSAnO1xuICB9XG5cbiAgc3RhdGljIGlzVmFsaWRSZXNwb25zZShkYXRhKSB7XG4gICAgbGV0IHJlc3BvbnNlO1xuICAgIHRyeSB7XG4gICAgICByZXNwb25zZSA9IEpTT04ucGFyc2UoZGF0YSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhpcy5MT0cuZXJyb3IoWydpc1ZhbGlkUmVzcG9uc2UnXSwgJ1Jlc3BvbnNlIG5vbiBKU09OIGNvbXBsaWFudCcsIGRhdGEpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoIUdUU0xpYi5pc0FycmF5KHJlc3BvbnNlKSkge1xuICAgICAgdGhpcy5MT0cuZXJyb3IoWydpc1ZhbGlkUmVzcG9uc2UnXSwgJ1Jlc3BvbnNlIGlzblxcJ3QgYW4gQXJyYXknLCByZXNwb25zZSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgc3RhdGljIGlzRW1iZWRkZWRJbWFnZShpdGVtKSB7XG4gICAgcmV0dXJuICEodHlwZW9mIGl0ZW0gIT09ICdzdHJpbmcnIHx8ICEvXmRhdGE6aW1hZ2UvLnRlc3QoaXRlbSkpO1xuICB9XG5cbiAgc3RhdGljIGlzRW1iZWRkZWRJbWFnZU9iamVjdChpdGVtKSB7XG4gICAgcmV0dXJuICEoKGl0ZW0gPT09IG51bGwpIHx8IChpdGVtLmltYWdlID09PSBudWxsKSB8fFxuICAgICAgKGl0ZW0uY2FwdGlvbiA9PT0gbnVsbCkgfHwgIUdUU0xpYi5pc0VtYmVkZGVkSW1hZ2UoaXRlbS5pbWFnZSkpO1xuICB9XG5cbiAgc3RhdGljIGlzUG9zaXRpb25BcnJheShpdGVtKSB7XG4gICAgaWYgKCFpdGVtIHx8ICFpdGVtLnBvc2l0aW9ucykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBpZiAoR1RTTGliLmlzUG9zaXRpb25zQXJyYXlXaXRoVmFsdWVzKGl0ZW0pIHx8IEdUU0xpYi5pc1Bvc2l0aW9uc0FycmF5V2l0aFR3b1ZhbHVlcyhpdGVtKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIChpdGVtLnBvc2l0aW9ucyB8fCBbXSkuZm9yRWFjaChwID0+IHtcbiAgICAgIGlmIChwLmxlbmd0aCA8IDIgfHwgcC5sZW5ndGggPiAzKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIGZvciAoY29uc3QgaiBpbiBwKSB7XG4gICAgICAgIGlmICh0eXBlb2YgcFtqXSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHN0YXRpYyBpc1Bvc2l0aW9uc0FycmF5V2l0aFZhbHVlcyhpdGVtKSB7XG4gICAgaWYgKChpdGVtID09PSBudWxsKSB8fCAoaXRlbS5wb3NpdGlvbnMgPT09IG51bGwpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIChpdGVtLnBvc2l0aW9ucyB8fCBbXSkuZm9yRWFjaChwID0+IHtcbiAgICAgIGlmIChwLmxlbmd0aCAhPT0gMykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGogaW4gcCkge1xuICAgICAgICBpZiAodHlwZW9mIHBbal0gIT09ICdudW1iZXInKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBzdGF0aWMgaXNQb3NpdGlvbnNBcnJheVdpdGhUd29WYWx1ZXMoaXRlbSkge1xuICAgIGlmICgoaXRlbSA9PT0gbnVsbCkgfHwgKGl0ZW0ucG9zaXRpb25zID09PSBudWxsKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAoaXRlbS5wb3NpdGlvbnMgfHwgW10pLmZvckVhY2gocCA9PiB7XG4gICAgICBpZiAocC5sZW5ndGggIT09IDQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgZm9yIChjb25zdCBqIGluIHApIHtcbiAgICAgICAgaWYgKHR5cGVvZiBwW2pdICE9PSAnbnVtYmVyJykge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgc3RhdGljIGd0c0Zyb21KU09OKGpzb24sIGlkKSB7XG4gICAgcmV0dXJuIHtndHM6IHtjOiBqc29uLmMsIGw6IGpzb24ubCwgYToganNvbi5hLCB2OiBqc29uLnYsIGlkfX07XG4gIH1cblxuICBzdGF0aWMgZ3RzRnJvbUpTT05MaXN0KGpzb25MaXN0LCBwcmVmaXhJZCkge1xuICAgIGNvbnN0IGd0c0xpc3QgPSBbXTtcbiAgICBsZXQgaWQ7XG4gICAgKGpzb25MaXN0IHx8IFtdKS5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICBsZXQgZ3RzID0gaXRlbTtcbiAgICAgIGlmIChpdGVtLmd0cykge1xuICAgICAgICBndHMgPSBpdGVtLmd0cztcbiAgICAgIH1cbiAgICAgIGlmICgocHJlZml4SWQgIT09IHVuZGVmaW5lZCkgJiYgKHByZWZpeElkICE9PSAnJykpIHtcbiAgICAgICAgaWQgPSBwcmVmaXhJZCArICctJyArIGk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZCA9IGk7XG4gICAgICB9XG4gICAgICBpZiAoR1RTTGliLmlzQXJyYXkoZ3RzKSkge1xuICAgICAgICBndHNMaXN0LnB1c2goR1RTTGliLmd0c0Zyb21KU09OTGlzdChndHMsIGlkKSk7XG4gICAgICB9XG4gICAgICBpZiAoR1RTTGliLmlzR3RzKGd0cykpIHtcbiAgICAgICAgZ3RzTGlzdC5wdXNoKEdUU0xpYi5ndHNGcm9tSlNPTihndHMsIGlkKSk7XG4gICAgICB9XG4gICAgICBpZiAoR1RTTGliLmlzRW1iZWRkZWRJbWFnZShndHMpKSB7XG4gICAgICAgIGd0c0xpc3QucHVzaCh7aW1hZ2U6IGd0cywgY2FwdGlvbjogJ0ltYWdlJywgaWR9KTtcbiAgICAgIH1cbiAgICAgIGlmIChHVFNMaWIuaXNFbWJlZGRlZEltYWdlT2JqZWN0KGd0cykpIHtcbiAgICAgICAgZ3RzTGlzdC5wdXNoKHtpbWFnZTogZ3RzLmltYWdlLCBjYXB0aW9uOiBndHMuY2FwdGlvbiwgaWR9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgY29udGVudDogZ3RzTGlzdCB8fCBbXSxcbiAgICB9O1xuICB9XG5cbiAgc3RhdGljIGZsYXREZWVwKGFycjE6IGFueVtdKTogYW55W10ge1xuICAgIGlmICghR1RTTGliLmlzQXJyYXkoYXJyMSkpIHtcbiAgICAgIGFycjEgPSBbYXJyMV07XG4gICAgfVxuICAgIHJldHVybiBhcnIxLnJlZHVjZSgoYWNjLCB2YWwpID0+IEFycmF5LmlzQXJyYXkodmFsKSA/IGFjYy5jb25jYXQoR1RTTGliLmZsYXREZWVwKHZhbCkpIDogYWNjLmNvbmNhdCh2YWwpLCBbXSk7XG4gIH1cblxuICBzdGF0aWMgZmxhdHRlbkd0c0lkQXJyYXkoYTogYW55W10sIHI6IG51bWJlcik6IHsgcmVzOiBhbnlbXSwgcjogbnVtYmVyIH0ge1xuICAgIGNvbnN0IHJlcyA9IFtdO1xuICAgIGlmIChHVFNMaWIuaXNHdHMoYSkpIHtcbiAgICAgIGEgPSBbYV07XG4gICAgfVxuICAgIChhIHx8IFtdKS5mb3JFYWNoKGQgPT4ge1xuICAgICAgaWYgKEdUU0xpYi5pc0FycmF5KGQpKSB7XG4gICAgICAgIGNvbnN0IHdhbGsgPSBHVFNMaWIuZmxhdHRlbkd0c0lkQXJyYXkoZCwgcik7XG4gICAgICAgIHJlcy5wdXNoKHdhbGsucmVzKTtcbiAgICAgICAgciA9IHdhbGsucjtcbiAgICAgIH0gZWxzZSBpZiAoZCAmJiBkLnYpIHtcbiAgICAgICAgZC5pZCA9IHI7XG4gICAgICAgIHJlcy5wdXNoKGQpO1xuICAgICAgICByKys7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHtyZXMsIHJ9O1xuICB9XG5cbiAgc3RhdGljIHNhbml0aXplTmFtZXMoaW5wdXQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIChpbnB1dCB8fCAnJykucmVwbGFjZSgvey9nLCAnJiMxMjM7JylcbiAgICAgIC5yZXBsYWNlKC99L2csICcmIzEyNTsnKVxuICAgICAgLnJlcGxhY2UoLywvZywgJyYjNDQ7JylcbiAgICAgIC5yZXBsYWNlKC8+L2csICcmIzYyOycpXG4gICAgICAucmVwbGFjZSgvPC9nLCAnJiM2MDsnKVxuICAgICAgLnJlcGxhY2UoL1wiL2csICcmIzM0OycpXG4gICAgICAucmVwbGFjZSgvJy9nLCAnJiMzOTsnKTtcbiAgfVxuXG4gIHN0YXRpYyBzZXJpYWxpemVHdHNNZXRhZGF0YShndHMpIHtcbiAgICBjb25zdCBzZXJpYWxpemVkTGFiZWxzID0gW107XG4gICAgY29uc3Qgc2VyaWFsaXplZEF0dHJpYnV0ZXMgPSBbXTtcbiAgICBpZiAoZ3RzLmwpIHtcbiAgICAgIE9iamVjdC5rZXlzKGd0cy5sKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgc2VyaWFsaXplZExhYmVscy5wdXNoKHRoaXMuc2FuaXRpemVOYW1lcyhrZXkgKyAnPScgKyBndHMubFtrZXldKSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGd0cy5hKSB7XG4gICAgICBPYmplY3Qua2V5cyhndHMuYSkuZm9yRWFjaCgoa2V5KSA9PiB7XG4gICAgICAgIHNlcmlhbGl6ZWRBdHRyaWJ1dGVzLnB1c2godGhpcy5zYW5pdGl6ZU5hbWVzKGtleSArICc9JyArIGd0cy5hW2tleV0pKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6bWF4LWxpbmUtbGVuZ3RoXG4gICAgcmV0dXJuIGAke3RoaXMuc2FuaXRpemVOYW1lcyhndHMuYyl9eyR7c2VyaWFsaXplZExhYmVscy5qb2luKCcsJyl9JHtzZXJpYWxpemVkQXR0cmlidXRlcy5sZW5ndGggPiAwID8gJywnIDogJyd9JHtzZXJpYWxpemVkQXR0cmlidXRlcy5qb2luKCcsJyl9fWA7XG4gIH1cblxuICBzdGF0aWMgaXNHdHMoaXRlbSkge1xuICAgIHJldHVybiAhIWl0ZW0gJiYgKGl0ZW0uYyA9PT0gJycgfHwgISFpdGVtLmMpICYmICEhaXRlbS52ICYmIEdUU0xpYi5pc0FycmF5KGl0ZW0udik7XG4gIH1cblxuICBzdGF0aWMgaXNHdHNUb1Bsb3QoZ3RzKSB7XG4gICAgaWYgKCFHVFNMaWIuaXNHdHMoZ3RzKSB8fCBndHMudi5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gV2UgbG9vayBhdCB0aGUgZmlyc3Qgbm9uLW51bGwgdmFsdWUsIGlmIGl0J3MgYSBTdHJpbmcgb3IgQm9vbGVhbiBpdCdzIGFuIGFubm90YXRpb24gR1RTLFxuICAgIC8vIGlmIGl0J3MgYSBudW1iZXIgaXQncyBhIEdUUyB0byBwbG90XG4gICAgcmV0dXJuIChndHMudiB8fCBbXSkuc29tZSh2ID0+IHtcbiAgICAgIC8vIG5vaW5zcGVjdGlvbiBKU1BvdGVudGlhbGx5SW52YWxpZENvbnN0cnVjdG9yVXNhZ2VcbiAgICAgIHJldHVybiB0eXBlb2Ygdlt2Lmxlbmd0aCAtIDFdID09PSAnbnVtYmVyJyB8fCAhIXZbdi5sZW5ndGggLSAxXS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUudG9GaXhlZDtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBpc0d0c1RvUGxvdE9uTWFwKGd0cykge1xuICAgIGlmICghR1RTTGliLmlzR3RzKGd0cykgfHwgZ3RzLnYubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIFdlIGxvb2sgYXQgdGhlIGZpcnN0IG5vbi1udWxsIHZhbHVlLCBpZiBpdCdzIGEgU3RyaW5nIG9yIEJvb2xlYW4gaXQncyBhbiBhbm5vdGF0aW9uIEdUUyxcbiAgICAvLyBpZiBpdCdzIGEgbnVtYmVyIGl0J3MgYSBHVFMgdG8gcGxvdFxuICAgIHJldHVybiAoZ3RzLnYgfHwgW10pLnNvbWUodiA9PiB7XG4gICAgICByZXR1cm4gdi5sZW5ndGggPj0gMztcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBpc1NpbmdsZXRvbkdUUyhndHMpIHtcbiAgICBpZiAoIUdUU0xpYi5pc0d0cyhndHMpIHx8IGd0cy52Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gKGd0cy52IHx8IFtdKS5sZW5ndGggPT09IDE7XG4gIH1cblxuICBzdGF0aWMgaXNHdHNUb0Fubm90YXRlKGd0cykge1xuICAgIGlmICghR1RTTGliLmlzR3RzKGd0cykgfHwgZ3RzLnYubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8vIFdlIGxvb2sgYXQgdGhlIGZpcnN0IG5vbi1udWxsIHZhbHVlLCBpZiBpdCdzIGEgU3RyaW5nIG9yIEJvb2xlYW4gaXQncyBhbiBhbm5vdGF0aW9uIEdUUyxcbiAgICAvLyBpZiBpdCdzIGEgbnVtYmVyIGl0J3MgYSBHVFMgdG8gcGxvdFxuICAgIHJldHVybiAoZ3RzLnYgfHwgW10pLnNvbWUodiA9PiB7XG4gICAgICBpZiAodlt2Lmxlbmd0aCAtIDFdICE9PSBudWxsKSB7XG4gICAgICAgIC8vIG5vaW5zcGVjdGlvbiBKU1BvdGVudGlhbGx5SW52YWxpZENvbnN0cnVjdG9yVXNhZ2VcbiAgICAgICAgcmV0dXJuIHR5cGVvZiAodlt2Lmxlbmd0aCAtIDFdKSAhPT0gJ251bWJlcicgJiZcbiAgICAgICAgICAoISF2W3YubGVuZ3RoIC0gMV0uY29uc3RydWN0b3IgJiYgdlt2Lmxlbmd0aCAtIDFdLmNvbnN0cnVjdG9yLm5hbWUgIT09ICdCaWcnKSAmJlxuICAgICAgICAgIHZbdi5sZW5ndGggLSAxXS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUudG9GaXhlZCA9PT0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgc3RhdGljIGd0c1NvcnQoZ3RzKSB7XG4gICAgaWYgKGd0cy5pc1NvcnRlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBndHMudiA9IGd0cy52LnNvcnQoKGEsIGIpID0+IGFbMF0gLSBiWzBdKTtcbiAgICBndHMuaXNTb3J0ZWQgPSB0cnVlO1xuICB9XG5cbiAgc3RhdGljIGdldERhdGEoZGF0YTogYW55KTogRGF0YU1vZGVsIHtcbiAgICBpZiAodHlwZW9mIGRhdGEgPT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gR1RTTGliLmdldERhdGEoSlNPTi5wYXJzZShkYXRhIGFzIHN0cmluZykpO1xuICAgIH0gZWxzZSBpZiAoZGF0YSAmJiBkYXRhLmhhc093blByb3BlcnR5KCdkYXRhJykpIHtcbiAgICAgIGlmICghR1RTTGliLmlzQXJyYXkoZGF0YS5kYXRhKSkge1xuICAgICAgICBkYXRhLmRhdGEgPSBbZGF0YS5kYXRhXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkYXRhIGFzIERhdGFNb2RlbDtcbiAgICB9IGVsc2UgaWYgKEdUU0xpYi5pc0FycmF5KGRhdGEpICYmIGRhdGEubGVuZ3RoID4gMCAmJiBkYXRhWzBdLmRhdGEpIHtcbiAgICAgIHJldHVybiBkYXRhWzBdIGFzIERhdGFNb2RlbDtcbiAgICB9IGVsc2UgaWYgKEdUU0xpYi5pc0FycmF5KGRhdGEpKSB7XG4gICAgICByZXR1cm4ge2RhdGE6IGRhdGEgYXMgR1RTW119IGFzIERhdGFNb2RlbDtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBEYXRhTW9kZWwoKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXREaXZpZGVyKHRpbWVVbml0OiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGxldCB0aW1lc3RhbXBEaXZpZGVyID0gMTAwMDsgLy8gZGVmYXVsdCBmb3IgwrVzIHRpbWV1bml0XG4gICAgaWYgKHRpbWVVbml0ID09PSAnbXMnKSB7XG4gICAgICB0aW1lc3RhbXBEaXZpZGVyID0gMTtcbiAgICB9XG4gICAgaWYgKHRpbWVVbml0ID09PSAnbnMnKSB7XG4gICAgICB0aW1lc3RhbXBEaXZpZGVyID0gMTAwMDAwMDtcbiAgICB9XG4gICAgcmV0dXJuIHRpbWVzdGFtcERpdmlkZXI7XG4gIH1cblxuICBzdGF0aWMgZm9ybWF0TGFiZWwgPSAoZGF0YTogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICBjb25zdCBzZXJpYWxpemVkR1RTID0gZGF0YS5zcGxpdCgneycpO1xuICAgIGxldCBkaXNwbGF5ID0gYDxzcGFuIGNsYXNzPVwiZ3RzSW5mb1wiPjxzcGFuIGNsYXNzPSdndHMtY2xhc3NuYW1lJz4ke3NlcmlhbGl6ZWRHVFNbMF19PC9zcGFuPmA7XG4gICAgaWYgKHNlcmlhbGl6ZWRHVFMubGVuZ3RoID4gMSkge1xuICAgICAgZGlzcGxheSArPSBgPHNwYW4gY2xhc3M9J2d0cy1zZXBhcmF0b3InPns8L3NwYW4+YDtcbiAgICAgIGNvbnN0IGxhYmVscyA9IHNlcmlhbGl6ZWRHVFNbMV0uc3Vic3RyKDAsIHNlcmlhbGl6ZWRHVFNbMV0ubGVuZ3RoIC0gMSkuc3BsaXQoJywnKTtcbiAgICAgIGlmIChsYWJlbHMubGVuZ3RoID4gMCkge1xuICAgICAgICBsYWJlbHMuZm9yRWFjaCgobCwgaSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGxhYmVsID0gbC5zcGxpdCgnPScpO1xuICAgICAgICAgIGlmIChsLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgIGRpc3BsYXkgKz0gYDxzcGFuPjxzcGFuIGNsYXNzPSdndHMtbGFiZWxuYW1lJz4ke2xhYmVsWzBdfTwvc3Bhbj5cbjxzcGFuIGNsYXNzPSdndHMtc2VwYXJhdG9yJz49PC9zcGFuPjxzcGFuIGNsYXNzPSdndHMtbGFiZWx2YWx1ZSc+JHtsYWJlbFsxXX08L3NwYW4+YDtcbiAgICAgICAgICAgIGlmIChpICE9PSBsYWJlbHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICBkaXNwbGF5ICs9IGA8c3Bhbj4sIDwvc3Bhbj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBkaXNwbGF5ICs9IGA8c3BhbiBjbGFzcz0nZ3RzLXNlcGFyYXRvcic+fTwvc3Bhbj5gO1xuICAgIH1cbiAgICBpZiAoc2VyaWFsaXplZEdUUy5sZW5ndGggPiAyKSB7XG4gICAgICBkaXNwbGF5ICs9IGA8c3BhbiBjbGFzcz0nZ3RzLXNlcGFyYXRvcic+ezwvc3Bhbj5gO1xuICAgICAgY29uc3QgbGFiZWxzID0gc2VyaWFsaXplZEdUU1syXS5zdWJzdHIoMCwgc2VyaWFsaXplZEdUU1syXS5sZW5ndGggLSAxKS5zcGxpdCgnLCcpO1xuICAgICAgaWYgKGxhYmVscy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGxhYmVscy5mb3JFYWNoKChsLCBpKSA9PiB7XG4gICAgICAgICAgY29uc3QgbGFiZWwgPSBsLnNwbGl0KCc9Jyk7XG4gICAgICAgICAgaWYgKGwubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgZGlzcGxheSArPSBgPHNwYW4+PHNwYW4gY2xhc3M9J2d0cy1hdHRybmFtZSc+JHtsYWJlbFswXX08L3NwYW4+XG48c3BhbiBjbGFzcz0nZ3RzLXNlcGFyYXRvcic+PTwvc3Bhbj48c3BhbiBjbGFzcz0nZ3RzLWF0dHJ2YWx1ZSc+JHtsYWJlbFsxXX08L3NwYW4+YDtcbiAgICAgICAgICAgIGlmIChpICE9PSBsYWJlbHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICBkaXNwbGF5ICs9IGA8c3Bhbj4sIDwvc3Bhbj5gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBkaXNwbGF5ICs9IGA8c3BhbiBjbGFzcz0nZ3RzLXNlcGFyYXRvcic+fTwvc3Bhbj5gO1xuICAgIH1cbiAgICBkaXNwbGF5ICs9ICc8L3NwYW4+JztcbiAgICByZXR1cm4gZGlzcGxheTtcbiAgfVxuXG4gIHN0YXRpYyB0b0lTT1N0cmluZyh0aW1lc3RhbXA6IG51bWJlciwgZGl2aWRlcjogbnVtYmVyLCB0aW1lWm9uZTogc3RyaW5nKSB7XG4gICAgaWYodGltZVpvbmUgIT09ICdVVEMnKSB7XG4gICAgICByZXR1cm4gbW9tZW50LnR6KHRpbWVzdGFtcCAvIGRpdmlkZXIsIHRpbWVab25lKS5mb3JtYXQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG1vbWVudCh0aW1lc3RhbXAgLyBkaXZpZGVyKS50b0lTT1N0cmluZygpO1xuICAgIH1cbiAgfVxufVxuIl19