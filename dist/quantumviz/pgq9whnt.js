/*! Built with http://stenciljs.com */
const{h:t}=window.quantumviz;import{a as e}from"./chunk-cbb0389a.js";import{a}from"./chunk-faa0a089.js";import"./chunk-ee323282.js";class i{constructor(){this.chartTitle="",this.responsive=!1,this.showLegend=!0,this.data="[]",this.options="",this.width="",this.height="",this.legendOffset=70}redraw(t,e){e!==t&&this.drawChart()}changeScale(t,e){if(e!==t){const e=JSON.parse(t);"timestamp"===e.time.timeMode?(this._chart.options.scales.xAxes[0].time.stepSize=e.time.stepSize,this._chart.options.scales.xAxes[0].time.unit=e.time.unit,this._chart.options.scales.xAxes[0].time.displayFormats.millisecond=e.time.displayFormats,this._chart.update()):(this._chart.options.scales.xAxes[0].time.stepSize=e.time.stepSize,this._chart.options.scales.xAxes[0].time.unit=e.time.unit,this._chart.update())}}hideData(t){if(t%2!=0&&-1!==t){const e=Math.trunc(t/2),a=this._chart.getDatasetMeta(e);null===a.hidden?a.hidden=!0:a.hidden=null,this._chart.update()}this.didHideOrShowAnomaly.emit()}minBoundChange(t,e){this._chart.options.animation.duration=0,e!==t&&(this._chart.options.scales.xAxes[0].time.min=t,this._chart.update())}maxBoundChange(t,e){this._chart.options.animation.duration=0,e!==t&&(this._chart.options.scales.xAxes[0].time.max=t,this._chart.update())}drawChart(){let t=this.el.shadowRoot.querySelector("#myChart"),a=this.gtsToScatter(JSON.parse(this.data)),i=30*a.length+this.legendOffset,s=this.height||""!==this.height?Math.max(i,parseInt(this.height)):i;this.height=s+"",console.log("height",this.height,i),t.parentElement.style.height=s+"px",t.parentElement.style.width="100%";const n=this;this._chart=new e.Scatter(t,{data:{datasets:a},options:{layout:{padding:{bottom:30*a.length}},legend:{display:this.showLegend},responsive:this.responsive,tooltips:{mode:"x",position:"nearest",custom:function(t){t.opacity>0?n.pointHover.emit({x:t.dataPoints[0].x+15,y:this._eventPosition.y}):n.pointHover.emit({x:-100,y:this._eventPosition.y})},callbacks:{title:(t,e)=>t[0].xLabel||"",label:(t,e)=>`${e.datasets[t.datasetIndex].label}: ${e.datasets[t.datasetIndex].data[t.index].val}`}},scales:{xAxes:[{drawTicks:!1,type:"time",time:{min:this.timeMin,max:this.timeMax,unit:"day"},gridLines:{display:!1}}],yAxes:[{display:!1,drawTicks:!1,scaleLabel:{display:!1},afterFit:function(t){t.width=100},ticks:{min:0,max:1,beginAtZero:!0,stepSize:1}}]}}})}buildImage(t,e,a){const i=new Image(t,e),s=`<svg width="${t}px" height="${e}px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${t} ${e}" preserveAspectRatio="xMidYMid">\n<rect width="${t}" height="${e}" style="fill:${a};" />\n</svg>`;return i.src="data:image/svg+xml;base64,"+btoa(s),i}gtsToScatter(t){console.log(t);let e=[];if(t)return t.forEach(t=>{console.log(t.gts),t.gts=a.flatDeep(t.gts),t.gts.forEach((i,s)=>{if(a.isGtsToAnnotate(i)){let n=[],h=a.getColor(s);const o=this.buildImage(1,30,h);i.v.forEach(t=>{n.push({x:t[0]/1e3,y:.5,val:t[t.length-1]})}),t.params&&t.params[s]&&t.params[s].color&&(h=t.params[s].color);let r=`${i.c} - ${JSON.stringify(i.l)}`;t.params&&t.params[s]&&t.params[s].key&&(r=t.params[s].key),e.push({label:r,data:n,pointRadius:5,pointHoverRadius:5,pointHitRadius:5,pointStyle:o,borderColor:h,backgroundColor:a.transparentize(h,.5)})}})}),e}componentDidLoad(){this.drawChart()}render(){return t("div",null,t("h1",null,this.chartTitle),t("div",{class:"chart-container",style:{position:"relative",width:this.width,height:this.height}},t("canvas",{id:"myChart",width:this.width,height:this.height})))}static get is(){return"quantum-annotation"}static get encapsulation(){return"shadow"}static get properties(){return{chartTitle:{type:String,attr:"chart-title"},data:{type:String,attr:"data",watchCallbacks:["redraw"]},el:{elementRef:!0},height:{type:String,attr:"height",mutable:!0},hiddenData:{type:Number,attr:"hidden-data",watchCallbacks:["hideData"]},options:{type:String,attr:"options",watchCallbacks:["changeScale"]},responsive:{type:Boolean,attr:"responsive"},showLegend:{type:Boolean,attr:"show-legend"},timeMax:{type:Number,attr:"time-max",watchCallbacks:["maxBoundChange"]},timeMin:{type:Number,attr:"time-min",watchCallbacks:["minBoundChange"]},width:{type:String,attr:"width"}}}static get events(){return[{name:"pointHover",method:"pointHover",bubbles:!0,cancelable:!0,composed:!0},{name:"didHideOrShowAnomaly",method:"didHideOrShowAnomaly",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"quantum-annotation .chart-container{width:var(--quantum-chart-width,100%);height:var(--quantum-chart-height,100%);position:relative}"}}export{i as QuantumAnnotation};